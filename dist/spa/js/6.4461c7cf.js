(self["webpackChunkbabylonjs_real_sun2"]=self["webpackChunkbabylonjs_real_sun2"]||[]).push([[6],{1006:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>$});var s=n(3673);const i={class:"bjs-canvas"};function a(e,t,n,a,r,o){return(0,s.wg)(),(0,s.j4)("canvas",i)}var r=n(3087),o=(n(9514),n(862),n(964),Math.PI),h=Math.sin,u=Math.cos,c=Math.tan,l=Math.asin,d=Math.atan2,_=Math.acos,w=o/180,f=864e5,g=2440588,m=2451545;function v(e){return e.valueOf()/f-.5+g}function p(e){return new Date((e+.5-g)*f)}function M(e){return v(e)-m}var S=23.4397*w;function b(e,t){return d(h(e)*u(S)-c(t)*h(S),u(e))}function P(e,t){return l(h(t)*u(S)+u(t)*h(S)*h(e))}function y(e,t,n){return d(h(e),u(e)*h(t)-c(n)*u(t))}function x(e,t,n){return l(h(t)*h(n)+u(t)*u(n)*u(e))}function D(e,t){return w*(280.16+360.9856235*e)-t}function C(e){return e<0&&(e=0),2967e-7/Math.tan(e+.00312536/(e+.08901179))}function T(e){return w*(357.5291+.98560028*e)}function V(e){var t=w*(1.9148*h(e)+.02*h(2*e)+3e-4*h(3*e)),n=102.9372*w;return e+t+n+o}function E(e){var t=T(e),n=V(t);return{dec:P(n,0),ra:b(n,0)}}var L={getPosition:function(e,t,n){var s=w*-n,i=w*t,a=M(e),r=E(a),o=D(a,s)-r.ra;return{azimuth:y(o,i,r.dec),altitude:x(o,i,r.dec)}}},N=L.times=[[-.833,"sunrise","sunset"],[-.3,"sunriseEnd","sunsetStart"],[-6,"dawn","dusk"],[-12,"nauticalDawn","nauticalDusk"],[-18,"nightEnd","night"],[6,"goldenHourEnd","goldenHour"]];L.addTime=function(e,t,n){N.push([e,t,n])};var k=9e-4;function R(e,t){return Math.round(e-k-t/(2*o))}function A(e,t,n){return k+(e+t)/(2*o)+n}function B(e,t,n){return m+e+.0053*h(t)-.0069*h(2*n)}function O(e,t,n){return _((h(e)-h(t)*h(n))/(u(t)*u(n)))}function z(e){return-2.076*Math.sqrt(e)/60}function I(e,t,n,s,i,a,r){var o=O(e,n,s),h=A(o,t,i);return B(h,a,r)}function Z(e){var t=w*(218.316+13.176396*e),n=w*(134.963+13.064993*e),s=w*(93.272+13.22935*e),i=t+6.289*w*h(n),a=5.128*w*h(s),r=385001-20905*u(n);return{ra:b(i,a),dec:P(i,a),dist:r}}function G(e,t){return new Date(e.valueOf()+t*f/24)}L.getTimes=function(e,t,n,s){s=s||0;var i,a,r,o,h,u,c=w*-n,l=w*t,d=z(s),_=M(e),f=R(_,c),g=A(0,c,f),m=T(g),v=V(m),S=P(v,0),b=B(g,m,v),y={solarNoon:p(b),nadir:p(b-.5)};for(i=0,a=N.length;i<a;i+=1)r=N[i],o=(r[0]+d)*w,h=I(o,c,l,S,f,m,v),u=b-(h-b),y[r[1]]=p(u),y[r[2]]=p(h);return y},L.getMoonPosition=function(e,t,n){var s=w*-n,i=w*t,a=M(e),r=Z(a),o=D(a,s)-r.ra,l=x(o,i,r.dec),_=d(h(o),c(i)*u(r.dec)-h(r.dec)*u(o));return l+=C(l),{azimuth:y(o,i,r.dec),altitude:l,distance:r.dist,parallacticAngle:_}},L.getMoonIllumination=function(e){var t=M(e||new Date),n=E(t),s=Z(t),i=149598e3,a=_(h(n.dec)*h(s.dec)+u(n.dec)*u(s.dec)*u(n.ra-s.ra)),r=d(i*h(a),s.dist-i*u(a)),o=d(u(n.dec)*h(n.ra-s.ra),h(n.dec)*u(s.dec)-u(n.dec)*h(s.dec)*u(n.ra-s.ra));return{fraction:(1+u(r))/2,phase:.5+.5*r*(o<0?-1:1)/Math.PI,angle:o}},L.getMoonTimes=function(e,t,n,s){var i=new Date(e);s?i.setUTCHours(0,0,0,0):i.setHours(0,0,0,0);for(var a,r,o,h,u,c,l,d,_,f,g,m,v,p=.133*w,M=L.getMoonPosition(i,t,n).altitude-p,S=1;S<=24;S+=2){if(a=L.getMoonPosition(G(i,S),t,n).altitude-p,r=L.getMoonPosition(G(i,S+1),t,n).altitude-p,u=(M+r)/2-a,c=(r-M)/2,l=-c/(2*u),d=(u*l+c)*l+a,_=c*c-4*u*a,f=0,_>=0&&(v=Math.sqrt(_)/(2*Math.abs(u)),g=l-v,m=l+v,Math.abs(g)<=1&&f++,Math.abs(m)<=1&&f++,g<-1&&(g=m)),1===f?M<0?o=S+g:h=S+g:2===f&&(o=S+(d<0?m:g),h=S+(d<0?g:m)),o&&h)break;M=r}var b={};return o&&(b.rise=G(i,o)),h&&(b.set=G(i,h)),o||h||(b[d>0?"alwaysUp":"alwaysDown"]=!0),b};const j=L,H=["Cedric","Deltakosh","Evgenii","Mawa","Necips","Pirate JC","Sebavan","Acamar","Ankaa","Betelgeuse","Botein","Celbalrai","Cedric","Deltakosh","Evgenii","Mawa","Necips","Pirate JC","Sebavan","Chort","Deneb","Diphda","Edasich","Cedric","Deltakosh","Evgenii","Mawa","Necips","Pirate JC","Sebavan","Furud","Homam","Izar","Kaffaljidhma","Cedric","Deltakosh","Evgenii","Mawa","Necips","Pirate JC","Sebavan","Kitalpha","Labris","Lesath","Marfik","Mebsuta","Cedric","Deltakosh","Evgenii","Mawa","Necips","Pirate JC","Sebavan","Mizar","Nusakan","Rasalgethi","Rastaban","Rigel","Cedric","Deltakosh","Evgenii","Mawa","Necips","Pirate JC","Sebavan","Sadalbari","Skat","Talitha","Tarf","Thuban","Cedric","Deltakosh","Evgenii","Mawa","Necips","Pirate JC","Sebavan","Wasat","Yed","Zubeneshamali"];function J(){return H[Math.round(Math.random()*H.length)]}function F(e,t,n){const s=t;return void 0===e[s]?n:e[s]}class W{constructor(e,t,n,s,i,a,o,h){this._transform=e,this._radius=t,this._lat=n,this._lng=s,this._northDirection=i,this._options=a,this._scene=o,this._sunLight=h,this._sunName="",this._beforeRenderObservable=null,this._sunMesh=null,this._sunMaterial=null,this._axesParent=null,this._sunName=J(),this._transformParent=new r.TransformNode("RealSun-ParentTransform",this._scene),this._transform.setParent(this._transformParent);const u=new Date;u.setHours(0,0,0,0),this._now=u.getTime(),this.calc(),this.calcSunPosition(),this._sunLight&&(this._sunLight.position=this.getPositionOffset())}setDateTimeInMillis(e,t=!0){this._now=e,t&&(this.calc(),this.calcSunPosition(),this.moveSun())}setParameters(e){this._sunName=J(),this._radius=e.radius,this._lat=e.lat,this._lng=e.lng,this._northDirection=new r.Vector3(e.northDirection.x,e.northDirection.y,e.northDirection.z),this.hideAxes(),this.showAxes()}calcSunPosition(){const e=j.getPosition(this._now,this._lat,this._lng);this._angles=e,this._transformParent.rotation.x=e.altitude,this._transformParent.rotation.y=-e.azimuth,this._sunLight&&(this._position=this._sunLight.getAbsolutePosition())}calc(){if(this._times=j.getTimes(this._now,this._lat,this._lng,0),this._sunrise=F(this._times,"sunrise").getTime(),this._sunriseEnd=F(this._times,"sunriseEnd").getTime(),this._sunset=F(this._times,"sunsetStart").getTime(),this._sunsetEnd=F(this._times,"sunset").getTime(),this._now>this._sunrise&&this._now<this._sunriseEnd){this._isSunrise=!0;const e=this._sunriseEnd-this._sunrise,t=this._now-this._sunrise,n=1/e;this._intensity=n*t}else this._isSunrise=!1;if(this._now>this._sunriseEnd&&this._now<this._sunset?(this._isDay=!0,this._intensity=1):this._isDay=!1,this._now>this._sunset&&this._now<this._sunsetEnd){this._isSunset=!0;const e=this._sunsetEnd-this._sunset,t=this._sunsetEnd-this._now,n=1/e;this._intensity=n*t}else this._isSunset=!1;this._now>this._sunsetEnd?(this._isNight=!0,this._intensity=0):this._isNight=!1}getInfo(){const e={name:this._sunName,radius:this._radius,sunrise:this._sunrise,sunriseEnd:this._sunriseEnd,sunset:this._sunset,sunsetEnd:this._sunsetEnd,isDay:this._isDay,isNight:this._isNight,intensity:this._intensity,isSunrise:this._isSunrise,isSunset:this._isSunset,dayStart:this._dayStart,now:this._now,dayTime:this._dayTime,position:{x:this._position.x,y:this._position.y,z:this._position.z},angles:this._angles,lat:this._lat,lng:this._lng,northDirection:{x:this._northDirection.x,y:this._northDirection.y,z:this._northDirection.z}};return e}getNow(){return this._now}setSun(e){this._sunLight=e}moveSun(){var e;if(!this._sunLight)return;this._sunLight.setDirectionToTarget(r.Vector3.Zero()),this._sunMesh;const t=null!==(e=this._options.sunMaxIntensity)&&void 0!==e?e:1;this._sunLight.intensity=this._intensity*t}showGadgets(){this.createDefaultSunMesh()}hideGadgets(){this._sunMesh&&(this._sunMesh.dispose(),this._sunMesh=null)}createDefaultSunLight(){var e;const t=r.Vector3.Zero(),n=new r.DirectionalLight(`RealSun-${this._sunName}`,t,this._scene);return this._sunLight=n,n.position=this.getPositionOffset(),n.range=this._radius,n.intensity=null!==(e=this._options.sunMaxIntensity)&&void 0!==e?e:1,this.calc(),n.parent=this._transform,n}getPositionOffset(){const e=this._radius;return this._northDirection.normalize().multiplyByFloats(e,e,e)}stopTimeSync(){this._beforeRenderObservable&&this._scene.onBeforeRenderObservable.remove(this._beforeRenderObservable)}startTimeSync(){this._sunLight?(this.calc(),this._beforeRenderObservable=this._scene.onBeforeRenderObservable.add((()=>this.moveSun()))):console.error("No sun. Call createDefaultSun() to create one or provide one in the constructor.")}static getCurrentTimeInMillis(){return Date.now().valueOf()}static getCurrentDate(){return Date.now()}static getCurrentDateShifted(e){const t=this.getCurrentTimeInMillis()+1e4*e;return new Date(t)}createDefaultSunMesh(e=!1){var t;if(this._sunMesh)return;const n=`RealSun-Mesh-${this._sunName}`,s=r.MeshBuilder.CreateSphere(n,{diameter:6},this._scene);this._sunMesh=s,s.parent=this._transform,s.position=this.getPositionOffset();const i=null!==(t=this._sunMaterial)&&void 0!==t?t:new r.PBRMaterial(`RealSun-Material-${this._sunName}`,this._scene);this._sunMaterial=i,i.emissiveColor=new r.Color3(1,1,0),s.material=i,e&&new r.GlowLayer("glow",this._scene,{mainTextureFixedSize:256,blurKernelSize:64})}makeTextPlane(e,t,n,s){const i=new r.DynamicTexture("RealSun-TextTexture",50,this._scene,!0);i.hasAlpha=!0,i.drawText(e,5,40,"bold 36px Arial",t,"transparent",!0);const a=r.Mesh.CreatePlane("TextPlane",n,this._scene,!0),o=new r.StandardMaterial("TextPlaneMaterial",this._scene);return o.backFaceCulling=!1,o.specularColor=new r.Color3(0,0,0),o.diffuseTexture=i,a.material=o,a.parent=s,a}hideAxes(){var e;this._axesParent&&(this._axesParent.getChildren().forEach((e=>e.dispose())),null===(e=this._axesParent)||void 0===e||e.dispose(),this._axesParent=null)}showAxes(e){if(this._axesParent)return;this._axesParent=new r.TransformNode("RealSun-AxesParentTransform",this._scene),e=null!==e&&void 0!==e?e:this._radius;const t=r.Mesh.CreateLines("axisX",[r.Vector3.Zero(),new r.Vector3(e,0,0),new r.Vector3(.95*e,.05*e,0),new r.Vector3(e,0,0),new r.Vector3(.95*e,-.05*e,0)],this._scene);t.color=new r.Color3(1,0,0);const n=this.makeTextPlane("X","red",e/10,this._axesParent);n.position=new r.Vector3(.9*e,.05*e,0);const s=r.Mesh.CreateLines("axisY",[r.Vector3.Zero(),new r.Vector3(0,e,0),new r.Vector3(-.05*e,.95*e,0),new r.Vector3(0,e,0),new r.Vector3(.05*e,.95*e,0)],this._scene);s.color=new r.Color3(0,1,0);const i=this.makeTextPlane("Y","green",e/10,this._axesParent);i.position=new r.Vector3(0,.9*e,-.05*e);const a=r.Mesh.CreateLines("axisZ",[r.Vector3.Zero(),new r.Vector3(0,0,e),new r.Vector3(0,-.05*e,.95*e),new r.Vector3(0,0,e),new r.Vector3(0,.05*e,.95*e)],this._scene);a.color=new r.Color3(0,0,1);const o=this.makeTextPlane("Z","blue",e/10,this._axesParent);o.position=new r.Vector3(0,.05*e,.9*e);const h=r.Vector3.ZeroReadOnly,u=r.MeshBuilder.CreateLines("axisLine",{points:[h.add(this._northDirection.scale(-50)),h.add(this._northDirection.scale(50))]},this._scene);u.color=new r.Color3(1,1,0),t.parent=this._axesParent,s.parent=this._axesParent,a.parent=this._axesParent,u.parent=this._axesParent}}var q=function(e,t,n,s){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,a){function r(e){try{h(s.next(e))}catch(S){a(S)}}function o(e){try{h(s["throw"](e))}catch(S){a(S)}}function h(e){e.done?n(e.value):i(e.value).then(r,o)}h((s=s.apply(e,t||[])).next())}))};let K=null;const Y=(0,s.aZ)({name:"RealSunSample",props:{isGadgetsVisible:{type:Boolean,default:!0},isAxesVisible:{type:Boolean,default:!0},realSunParameters:{type:Object,required:!1}},watch:{isGadgetsVisible(e){!0===e?null===K||void 0===K||K.showGadgets():null===K||void 0===K||K.hideGadgets()},isAxesVisible(e){!0===e?null===K||void 0===K||K.showAxes():null===K||void 0===K||K.hideAxes()},realSunParameters(e){null===K||void 0===K||K.setParameters(e)}},setup(e,{emit:t}){return(0,s.bv)((()=>q(this,void 0,void 0,(function*(){const e=document.getElementsByClassName("bjs-canvas")[0];e.width=window.innerWidth,e.height=window.innerHeight;const n=new r.Engine(e);var s=new r.Scene(n);const i="localhost"===location.hostname||"127.0.0.1"===location.hostname?"/models/":"https://babylonjs.nascor.tech/boxes/",a=yield r.SceneLoader.AppendAsync(i,"real-sun-building-trees.glb",s),o=a.meshes[0];o.rotation=r.Vector3.Zero();const h=s.getMeshByName("Plane_Baked");h&&(h.receiveShadows=!0);const u=s.getMeshByName("BuildingA_Baked"),c=new r.TransformNode("sunTransform",s),l=47.53217606106968,d=19.06586400848718,_=40,w=new r.Vector3(.2,0,-1);K=new W(c,_,l,d,w,{},s);const f=K.createDefaultSunLight();K.showAxes(),K.createDefaultSunMesh(!0),K.showGadgets();var g=new r.ShadowGenerator(1024,f);u&&g.addShadowCaster(u);const m=s.meshes.filter((e=>e.name.startsWith("leaves")||e.name.startsWith("Regular")));m.forEach((e=>{g.addShadowCaster(e)})),g.useExponentialShadowMap=!0,g.setDarkness(0);var v=new r.ArcRotateCamera("camera1",-.7,1,110,new r.Vector3(0,0,0),s);v.setTarget(r.Vector3.Zero()),v.attachControl(e,!0),v.useAutoRotationBehavior=!0;const p=new r.HemisphericLight("ambientLight",new r.Vector3(0,1,0),s);p.intensity=.7;const M=new r.PointLight("nightLight",new r.Vector3(1.8,19,0),s);M.diffuse=new r.Color3(1,0,0),M.specular=new r.Color3(0,1,0),M.intensity=.1;let S=0,b=1e5;s.onBeforeRenderObservable.add((()=>{if(S+=b,K){K.setDateTimeInMillis(Date.now()+S,!1),K.calc(),K.calcSunPosition(),K.moveSun();const e=K.getInfo();t("realSunInfoReceived",e),b=!0===e.isSunset||!0===e.isSunrise?400:5e4,s.clearColor=new r.Color4(.2,.4,.7,1).multiply(new r.Color4(e.intensity,e.intensity,e.intensity,1)),M.intensity=100-100*e.intensity,p.intensity=e.intensity>.7?.7:e.intensity}}));const P=()=>{n.resize()};window.addEventListener("resize",P),n.runRenderLoop((()=>{s.render()}))})))),{}}});Y.render=a;const $=Y}}]);